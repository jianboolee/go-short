version: '3.8'

services:
  go-short:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: go-short
    ports:
      - "${PORT:-8080}:8080"
    environment:
      # 自定义域名（可选）
      - DOMAIN=${DOMAIN:-}
      # 基础路径（可选，默认空）
      - BASE_PATH=${BASE_PATH:-}
      # 服务端口（默认 8080）
      - PORT=${PORT:-8080}
      # 数据库路径（容器内路径）
      - DB_PATH=${DB_PATH:-/app/data/shortlinks.db}
      # 短链接码长度（默认 4）
      - CODE_LENGTH=${CODE_LENGTH:-4}
      # API Key（可选，如果设置则需要验证）
      - API_KEY=${API_KEY:-}
    volumes:
      # 数据持久化：将数据目录挂载到宿主机
      - ./data:/app/data
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8080/health"]
      interval: 30s
      timeout: 3s
      start_period: 5s
      retries: 3
    networks:
      - go-short-network

networks:
  go-short-network:
    driver: bridge
